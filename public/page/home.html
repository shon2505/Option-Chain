<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Option Chain</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        thead {
            background-color: #003366;
            color: white;
        }

        .positive {
            color: green;
        }

        .negative {
            color: red;
        }
    </style>
</head>

<body>
    <table id="data-table">
        <thead>
            <tr>
                <th colspan="13">Options Data</th>
            </tr>
            <tr>
                <th colspan="6">Call</th>
                <th></th>
                <th colspan="6">Put</th>
            </tr>
            <tr>
                <th>OI</th>
                <th>Chng in OI</th>
                <th>Volume</th>
                <th>IV</th>
                <th>LTP</th>
                <th>Chng</th>
                <th>Strike</th>
                <th>OI</th>
                <th>Chng in OI</th>
                <th>Volume</th>
                <th>IV</th>
                <th>LTP</th>
                <th>Chng</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script>
        async function fetchData() {
            try {
                const response = await fetch('http://localhost:3000/api/v1/optionChain');
                const data = await response.json();
                populateTable(data);
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }
        function createCell(content, className = '') {
            const td = document.createElement('td');
            td.textContent = content !== undefined && content !== null ? content : '-';
            if (className) {
                td.className = className;
            }
            return td;
        }
        function formatCellContent(content) {

            if (typeof content !== 'string') {
                content = String(content);
            }
            return content;
        }

        function createRow(ce = {}, pe = {}) {
            const tr = document.createElement('tr');

            tr.appendChild(createCell(ce.oi || '-'));
            tr.appendChild(createCell(formatCellContent(ce.chng_in_oi || '-'), formatCellContent(ce.chng_in_oi).startsWith('-') ? 'negative' : 'positive'));
            tr.appendChild(createCell(ce.volume || '-'));
            tr.appendChild(createCell(ce.iv || '-'));
            tr.appendChild(createCell(ce.ltp || '-'));
            tr.appendChild(createCell(formatCellContent(ce.chng || '-'), formatCellContent(ce.chng).startsWith('-') ? 'negative' : 'positive'));
            tr.appendChild(createCell(ce.strike || '-'));

            // Empty cell for separator
            tr.appendChild(createCell(''));

            // Create cells for Put (PE)
            tr.appendChild(createCell(pe.oi || '-'));
            tr.appendChild(createCell(formatCellContent(pe.chng_in_oi || '-'), formatCellContent(pe.chng_in_oi).startsWith('-') ? 'negative' : 'positive'));
            tr.appendChild(createCell(pe.volume || '-'));
            tr.appendChild(createCell(pe.iv || '-'));
            tr.appendChild(createCell(pe.ltp || '-'));
            tr.appendChild(createCell(formatCellContent(pe.chng || '-'), formatCellContent(pe.chng).startsWith('-') ? 'negative' : 'positive'));

            return tr;
        }

        function populateTable(data) {
            const tbody = document.querySelector('#data-table tbody');
            tbody.innerHTML = '';


            Object.keys(data).forEach(expiryDate => {
                const expiryData = data[expiryDate];
                expiryData.CE.forEach((ce, index) => {
                    const pe = expiryData.PE[index] || {};
                    tbody.appendChild(createRow(ce, pe));
                });
            });
        }

        window.onload = fetchData;
        setInterval(() => {
            fetchData();
        }, 10000); 
    </script>
</body>

</html>